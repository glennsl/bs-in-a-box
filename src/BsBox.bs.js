// Generated by BUCKLESCRIPT VERSION 2.1.0, PLEASE EDIT WITH CARE
'use strict';

var Block      = require("bs-platform/lib/js/block.js");
var Js_exn     = require("bs-platform/lib/js/js_exn.js");
var Pervasives = require("bs-platform/lib/js/pervasives.js");

function toResult(jsObj) {
  var match = jsObj.js_code;
  if (match == null) {
    var match$1 = jsObj.text;
    if (match$1 == null) {
      return Pervasives.failwith("unknown response from compiler");
    } else {
      return /* Error */Block.__(1, [match$1]);
    }
  } else {
    return /* Ok */Block.__(0, [match]);
  }
}


  function _captureConsoleErrors(f) {
    let errors = "";
    const _consoleError = console.error;
    console.error = (...args) => args.forEach(argument => errors += argument + `\n`);

    let res = f();

    console.error = _consoleError;
    return [res, errors ? [errors] : 0];
  }

;

function compile(code) {
  try {
    var match = _captureConsoleErrors((function () {
            return window.ocaml.compile(code);
          }));
    var param = toResult(JSON.parse(match[0]));
    if (param.tag) {
      return /* Error */Block.__(1, [param[0]]);
    } else {
      return /* Ok */Block.__(0, [/* record */[
                  /* code */param[0],
                  /* warnings */match[1]
                ]]);
    }
  }
  catch (raw_exn){
    var exn = Js_exn.internalToOCamlException(raw_exn);
    return /* Error */Block.__(1, ["Unrecognized compiler output: " + (String(exn) + "")]);
  }
}

exports.compile = compile;
/*  Not a pure module */
